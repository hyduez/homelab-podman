services:
  database:
    image: docker.io/library/postgres:alpine
    container_name: nextcloud-database
    restart: always
    volumes:
      - ./data/postgres:/var/lib/postgresql/data:Z,U
    environment:
      - POSTGRES_DB
      - POSTGRES_USER
      - POSTGRES_PASSWORD
    networks:
      nextcloud-network:
        ipv4_address: 10.83.6.10

  redis:
    image: docker.io/library/redis
    container_name: nextcloud-redis
    restart: always
    networks:
      nextcloud-network:
        ipv4_address: 10.83.6.11

  nextcloud:
    image: docker.io/library/nextcloud
    container_name: nextcloud
    restart: always
    depends_on:
      - database
      - redis
    ports:
      - 3002:80
    volumes:
      - ./data/nextcloud:/var/www/html:Z,U
    environment:
      - POSTGRES_HOST
      - POSTGRES_DB
      - POSTGRES_USER
      - POSTGRES_PASSWORD
      - REDIS_HOST
      - NEXTCLOUD_ADMIN_PASSWORD
      - NEXTCLOUD_ADMIN_USER
      - NEXTCLOUD_TRUSTED_DOMAINS
    networks:
      nextcloud-network:
        ipv4_address: 10.83.6.12

volumes:
  nextcloud:
  database:

networks:
  nextcloud-network:
    external: true
